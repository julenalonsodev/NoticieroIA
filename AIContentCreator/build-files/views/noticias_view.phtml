<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Noticias - AI Content Creator</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="<?= BASE_URL ?>styles/home.css">
    <link rel="stylesheet" href="<?= BASE_URL ?>styles/noticias.css">
</head>

<body>

    <!-- CABECERA -->
    <header>AI CONTENT CREATOR - Noticias</header>

    <div class="news-header-bar">
        <h1 class="page-title">
            Noticias
            <?php if (!empty($__generoTema)): ?>
                <small style="font-size: 0.7em; font-weight: normal;">
                    (Género: <?= htmlspecialchars($__generoTema, ENT_QUOTES, 'UTF-8') ?>)
                </small>
            <?php endif; ?>
        </h1>

        <a href="<?= BASE_URL ?>index.php?controller=home" class="btn btn-back">
            ← Volver al Home
        </a>
    </div>

    <?php if (!empty($__idGenero)): ?>
        <p class="page-sub">
            Listado de noticias generadas para el género
            <strong><?= htmlspecialchars($__generoTema ?? ('ID ' . $__idGenero), ENT_QUOTES, 'UTF-8') ?></strong>.
        </p>
    <?php else: ?>
        <p class="page-sub">Listado de todas las noticias generadas en la plataforma</p>
    <?php endif; ?>

    <main>

        <?php if (!empty($noticias) && is_array($noticias)): ?>

            <table class="news-table">
                <thead>
                    <tr>
                        <th>Título</th>
                        <th>Descripción</th>
                        <th>Imagen</th>
                    </tr>
                </thead>

                <tbody>

                    <?php foreach ($noticias as $row): ?>

                        <?php
                            $titulo      = $row['titulo'] ?? '';
                            $descripcion = $row['descripcion'] ?? '';
                            $imagen      = $row['imagen'] ?? '';
                        ?>

                        <tr>

                            <!-- TÍTULO -->
                            <td style="max-width: 350px; white-space: normal;">
                                <strong><?= nl2br(htmlspecialchars($titulo, ENT_QUOTES, 'UTF-8')) ?></strong><br>
                                <small>
                                    <?php if (!empty($row['fecha_publicacion'])): ?>
                                        <?= date("d/m/Y H:i", strtotime($row['fecha_publicacion'])) ?>
                                    <?php else: ?>
                                        No publicada
                                    <?php endif; ?>
                                </small>
                            </td>

                            <!-- DESCRIPCIÓN -->
                            <td class="td-descripcion">
                                <div class="descripcion-scroll">
                                    <?= nl2br(htmlspecialchars($descripcion, ENT_QUOTES, 'UTF-8')) ?>
                                </div>
                            </td>

                            <!-- IMAGEN -->
                            <td class="td-imagen">
                                <?php if (!empty($imagen)): ?>
                                    <img src="<?= htmlspecialchars($imagen, ENT_QUOTES, 'UTF-8') ?>"
                                         alt="Imagen noticia"
                                         class="img-ajustada">
                                <?php else: ?>
                                    <em>Sin imagen</em>
                                <?php endif; ?>
                            </td>

                        </tr>

                    <?php endforeach; ?>

                </tbody>
            </table>

        <?php else: ?>

            <p>No hay noticias creadas todavía.</p>

        <?php endif; ?>

    </main>

</body>
</html>
