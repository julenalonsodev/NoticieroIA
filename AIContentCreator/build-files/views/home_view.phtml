<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Home - AI Content Creator</title>

    <link rel="stylesheet" href="<?= BASE_URL ?>styles/home.css">
</head>

<body>

    <!-- HEADER -->
    <header>AI CONTENT CREATOR</header>

    <div class="layout">

        <!-- ASIDE -->
        <aside>
            <div>
                <div class="user-avatar">
                    <?= strtoupper(substr($usuario['nombre'] ?? '', 0, 1)) ?>
                </div>

                <div class="user-block-name">
                    <?= htmlspecialchars($usuario['nombre'] ?? '', ENT_QUOTES, 'UTF-8') ?>
                    <?= htmlspecialchars($usuario['apellidos'] ?? '', ENT_QUOTES, 'UTF-8') ?>
                </div>

                <div class="user-block-email">
                    <?= htmlspecialchars($usuario['email'] ?? '', ENT_QUOTES, 'UTF-8') ?>
                </div>

                <div style="margin-top: 14px; font-size:13px; color:var(--muted); text-align:center;">
                    <p>DNI: <?= htmlspecialchars($usuario['dni'] ?? '', ENT_QUOTES, 'UTF-8') ?></p>
                    <p>Empresa N¬∫: <?= htmlspecialchars($usuario['numero_empresa'] ?? '', ENT_QUOTES, 'UTF-8') ?></p>
                </div>

                <nav class="aside-menu" style="margin-top:25px;">
                    <ul>
                        <li>
                            <a class="active" href="<?= BASE_URL ?>index.php?controller=home">
                                <span>üè†</span> Inicio
                            </a>
                        </li>
                        <li>
                            <a href="<?= BASE_URL ?>index.php?controller=noticias">
                                <span>üìù</span> Noticias
                            </a>
                        </li>
                        <li><a href="#"><span>üéõÔ∏è</span> Preferencias</a></li>
                        <li><a href="#"><span>‚öôÔ∏è</span> Ajustes</a></li>
                        <li><a href="#"><span>‚ùì</span> Ayuda</a></li>
                        <li>
                            <a href="<?= BASE_URL ?>index.php?controller=auth&action=logout">
                                <span>‚èª</span> Cerrar sesi√≥n
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- MAIN -->
        <main>
            <h1 class="page-title">G√©neros</h1>
            <p class="page-sub">Selecciona una categor√≠a para continuar</p>

            <?php if (!empty($generos) && is_array($generos)): ?>
                <?php foreach ($generos as $row): ?>
                    <article class="card">
                        <div class="card-header">
                            <h3><?= htmlspecialchars($row['tema'] ?? '', ENT_QUOTES, 'UTF-8') ?></h3>

                            <!-- Eliminar g√©nero -->
                            <form method="POST"
                                  action="<?= BASE_URL ?>controllers/eliminar_genero.php"
                                  class="delete-form">
                                <input type="hidden" name="id" value="<?= (int)($row['id_genero'] ?? 0) ?>">
                                <button type="submit"
                                        class="btn btn-delete"
                                        onclick="return confirm('¬øSeguro que deseas eliminar este g√©nero?');">
                                    Eliminar
                                </button>
                            </form>
                        </div>

                        <p><?= htmlspecialchars($row['descripcion'] ?? '', ENT_QUOTES, 'UTF-8') ?></p>
                        <p>
                            <?= htmlspecialchars($row['frecuencia'] ?? '', ENT_QUOTES, 'UTF-8') ?>
                            ‚Ä¢ <?= (int)($row['cantidad'] ?? 0) ?>
                            ‚Ä¢ <?= strtoupper(htmlspecialchars($row['idioma'] ?? '', ENT_QUOTES, 'UTF-8')) ?>
                        </p>

                        <!-- Ir a art√≠culos del g√©nero -->
                        <form method="POST"
                              action="<?= BASE_URL ?>controllers/generar_articulos.php"
                              style="display:inline;">
                            <input type="hidden" name="id_genero" value="<?= (int)($row['id_genero'] ?? 0) ?>">
                            <button type="submit" class="btn-link">
                                Ir a art√≠culos ‚Üí
                            </button>
                        </form>

                    </article>
                <?php endforeach; ?>
            <?php else: ?>
                <p>No hay g√©neros todav√≠a. Crea uno con el bot√≥n ‚Äú+‚Äù.</p>
            <?php endif; ?>

        </main>

    </div>

    <footer>
        ¬© 2025 AI Content Creator - Todos los derechos reservados
    </footer>

    <!-- BOT√ìN FLOTANTE -->
    <button id="fabAdd" class="fab" aria-label="A√±adir G√©nero" title="A√±adir G√©nero">+</button>

    <!-- MODAL NUEVO G√âNERO -->
    <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">

            <div class="modal-header">
                <h3 id="modalTitle" class="modal-title">Nuevo G√©nero</h3>
                <button class="btn ghost" id="btnClose" type="button">‚úï</button>
            </div>

            <form id="genreForm"
                  method="POST"
                  action="<?= BASE_URL ?>controllers/guardar_genero.php">
                <div class="modal-body">

                    <!-- TEMA -->
                    <div>
                        <label for="tema">Tema</label>
                        <input type="text" id="tema" name="tema" required>
                    </div>

                    <!-- DESCRIPCI√ìN -->
                    <div>
                        <label for="descripcion">Descripci√≥n</label>
                        <input type="text" id="descripcion" name="descripcion" required>
                    </div>

                    <!-- FRECUENCIA -->
                    <div>
                        <label for="frecuencia">Frecuencia</label>
                        <select id="frecuencia" name="frecuencia" required>
                            <option value="" disabled selected>Selecciona‚Ä¶</option>
                            <option value="Diario">Diario</option>
                            <option value="Semanal">Semanal</option>
                            <option value="Mensual">Mensual</option>
                        </select>
                    </div>

                    <!-- CANTIDAD -->
                    <div>
                        <label for="cantidad">Cantidad</label>
                        <input type="number" id="cantidad" name="cantidad" min="1" required>
                    </div>

                    <!-- A√ëADIR FUENTES -->
                    <div id="addSourcesContainer">
                        <label for="addSources">¬øA√±adir Fuentes?</label>
                        <select id="addSources" name="addSources">
                            <option value="no" selected>No</option>
                            <option value="si">S√≠</option>
                        </select>
                    </div>

                    <!-- IDIOMA -->
                    <div>
                        <label for="idioma">Idioma</label>
                        <select id="idioma" name="idioma" required>
                            <option value="" disabled selected>Selecciona‚Ä¶</option>
                            <option value="es">Espa√±ol</option>
                            <option value="en">Ingl√©s</option>
                            <option value="fr">Franc√©s</option>
                        </select>
                    </div>

                    <!-- SECCI√ìN DE FUENTES -->
                    <div id="sourcesSection" class="sources-section">
                        <label>Fuentes</label>
                        <div id="sourcesList"></div>
                        <button type="button" class="btn add-source" id="btnAddSource">
                            + A√±adir fuente
                        </button>
                    </div>

                    <!-- FUENTES EN JSON -->
                    <input type="hidden" id="fuentes" name="fuentes">

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn ghost" id="btnCancel">Cancelar</button>
                    <button type="submit" class="btn primary">Guardar</button>
                </div>
            </form>

        </div>
    </div>

    <script src="<?= BASE_URL ?>code/home.js"></script>
    <script src="<?= BASE_URL ?>code/generos.js"></script>

</body>

</html>
